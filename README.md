<div align="center">

# Cross-Lingual Knowledge Distillation

<a href="https://pytorch.org/get-started/locally/"><img alt="PyTorch" src="https://img.shields.io/badge/PyTorch-ee4c2c?logo=pytorch&logoColor=white"></a>
<a href="https://pytorchlightning.ai/"><img alt="Lightning" src="https://img.shields.io/badge/-Lightning-792ee5?logo=pytorchlightning&logoColor=white"></a>
<a href="https://hydra.cc/"><img alt="Config: Hydra" src="https://img.shields.io/badge/Config-Hydra-89b8cd"></a>
<a href="https://github.com/ashleve/lightning-hydra-template"><img alt="Template" src="https://img.shields.io/badge/-Lightning--Hydra--Template-017F2F?style=flat&logo=github&labelColor=gray"></a><br>

</div>

## ðŸ“Œ&nbsp;&nbsp;Introduction
This project enables to distill multilingual transformers into language-specific students. Features contain:

- Adjust any distillation loss 
- Any number of students and languages per student
- Change the teacher and student architecture 
- Choose between monolingual, bilingual, or multilingual distillation setup
- Compnent Sharing across students
- Initialization of students from teacher layers

## ðŸš€&nbsp;&nbsp;Quickstart

Configure your environment first.

```bash
# clone project
git clone https://github.com/MinhDucBui/clkd.git
cd clkd

# [OPTIONAL] create conda environment
conda create -n myenv python=3.9
conda activate myenv

# install requirements
pip install -r requirements.txt

# Please make sure to have the right Pytorch Version: Install pytorch according to instructions
# https://pytorch.org/get-started/
```

Execute the main script. The default setting uses the same strategy as MonoShot.
```bash
# Choose GPU Device
export CUDA_VISIBLE_DEVICES=0

# execute main script
python run.py
```

### âš¡&nbsp;&nbsp;Your Superpowers

<details>
<summary><b>Change Distillation Loss</b></summary>

> Hydra allows you to easily overwrite any parameter defined in your config. See students/individuals/loss for all loss functions.

```bash
python run.py students/individual/loss=monoalignment
```

</details>

<details>
<summary><b>Change Student Number and Languages</b></summary>

> We constructed some default configs for different scenarios:

```bash
# monolingual setting with english-turkish language pair
python train.py experiment=monolingual

# monolingual setting with english-basque language pair
python train.py experiment=monolingual_eu

# monolingual setting with english-turkish language pair
python train.py experiment=monolingual_sw

# monolingual setting with english-turkish language pair
python train.py experiment=monolingual_ur

# bilingual setting with english-turkish language pair
python train.py experiment=monolingual_bilingual
```

To construct a custom setting, please see the documentation [here](https://github.com/MinhDucBui/clkd/blob/main/configs/experiment/monolingual.yaml).

</details>

<details>
<summary><b>Change Component-sharing across Students</b></summary>

First, we look at embedding sharing.
```bash
# Share language embeddings only in each student, not across students.
python run.py students.embed_sharing="in_each_model" 
```
To construct a custom setting, please see the documentation [here](https://github.com/MinhDucBui/clkd/blob/main/configs/experiment/monolingual.yaml).

  
</details>

<details>
<summary><b>Change Student Architecture</b></summary>

```bash
# Use the same architecture as the teacher
python run.py students/individual/model=from_teacher
```
More architectures can be found [here](https://github.com/MinhDucBui/clkd/tree/main/configs/students/individual/model).   

</details>

<br>

## Project Structure
The directory structure of new project looks like this:
```

â”œâ”€â”€ configs                 <- Hydra configuration files
â”‚   â”œâ”€â”€ callbacks               <- Callbacks configs
â”‚   â”œâ”€â”€ collate_fn              <- Collate functions configs
â”‚   â”œâ”€â”€ datamodule              <- Datamodule configs
â”‚   â”œâ”€â”€ distillation_setup      <- Distillation configs
â”‚   â”œâ”€â”€ evaluation              <- Evaluation configs
â”‚   â”œâ”€â”€ experiment              <- Experiment configs
â”‚   â”œâ”€â”€ hydra                   <- Hydra related configs
â”‚   â”œâ”€â”€ logger                  <- Logger configs
â”‚   â”œâ”€â”€ students                <- Student configs
â”‚   â”œâ”€â”€ teacher                 <- Teacher configs
â”‚   â”œâ”€â”€ trainer                 <- Trainer configs
â”‚   â”‚
â”‚   â””â”€â”€ config.yaml             <- Main project configuration file
â”‚
â”œâ”€â”€ data                    <- Project data
â”‚
â”œâ”€â”€ logs                    <- Logs generated by Hydra and PyTorch Lightning loggers
â”‚
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ callbacks               <- Lightning callbacks
â”‚   â”œâ”€â”€ datamodules             <- Lightning datamodules
â”‚   â”œâ”€â”€ distillation            <- Distillation Setup Files
â”‚   â”œâ”€â”€ evaluation              <- Evaluation Files
â”‚   â”œâ”€â”€ los                     <- Loss Files
â”‚   â”œâ”€â”€ models                  <- Lightning models
â”‚   â”œâ”€â”€ utils                   <- Utility scripts
â”‚   â”‚
â”‚   â””â”€â”€ train.py                <- Training pipeline
â”‚
â”œâ”€â”€ run.py                  <- Run pipeline with chosen experiment configuration
â”‚
â”œâ”€â”€ .env.example            <- Template of the file for storing private environment variables
â”œâ”€â”€ .gitignore              <- List of files/folders ignored by git
â”œâ”€â”€ .pre-commit-config.yaml <- Configuration of automatic code formatting
â”œâ”€â”€ setup.cfg               <- Configurations of linters and pytest
â”œâ”€â”€ Dockerfile              <- File for building docker container
â”œâ”€â”€ requirements.txt        <- File for installing python dependencies
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md
```
<br>
